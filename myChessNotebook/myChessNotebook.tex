%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% The Legrand Orange Book
% LaTeX Template
% Version 3.1 (February 18, 2022)
%
% This template originates from:
% https://www.LaTeXTemplates.com
%
% Authors:
% Vel (vel@latextemplates.com)
% Mathias Legrand (legrand.mathias@gmail.com)
%
% License:
% CC BY-NC-SA 4.0 (https://creativecommons.org/licenses/by-nc-sa/4.0/)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass[
	11pt, % Default font size, select one of 10pt, 11pt or 12pt
	fleqn, % Left align equations
	a4paper, % Paper size, use either 'a4paper' for A4 size or 'letterpaper' for US letter size
	oneside, % Oneside mode, more suitable if the book is to be read on a screen or print-on-demand
]{memoir}

%----------------------------------------------------------------------------------------
%	CORE PACKAGES (replacing what the old class loaded)
%----------------------------------------------------------------------------------------

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

\usepackage{graphicx}
\usepackage[usenames, svgnames, table]{xcolor}

\usepackage{lmodern} % Latin Modern = scalable Computer Modern
\usepackage{microtype}

\usepackage{geometry}
\geometry{
	top=3cm,
	bottom=2.5cm,
	inner=1.5cm,
	outer=1.5cm,
	headsep=10pt,
	headheight=14pt,
	footskip=1.4cm,
	columnsep=1cm
}

\usepackage{hyperref}
\usepackage[nonumberlist]{glossaries}
\makeglossaries

% Header/footer styling similar to the old Legrand template
\usepackage{fancyhdr}
\pagestyle{fancy}
\renewcommand{\headrulewidth}{0.5pt}
\fancyhf{}
\fancyhead[LE,RO]{\thepage}
\fancyhead[LO]{\rightmark}
\fancyhead[RE]{\leftmark}
\fancypagestyle{plain}{%
  \fancyhead{}%
  \renewcommand{\headrulewidth}{0pt}%
}

% Section and TOC formatting (you were already using these)
\usepackage[explicit]{titlesec}
\usepackage{tocloft}

% Bibliography and index setup (mirroring the old class)
\usepackage[
	backend=biber,
	bibstyle=numeric,
	citestyle=numeric,
	sorting=nyt,
	sortcites=true,
	abbreviate=false,
	backref=true
]{biblatex}
\defbibheading{bibempty}{}

\usepackage{makeidx}
\makeindex
\usepackage{etoolbox}

%----------------------------------------------------------------------------------------
%	BUILD FLAGS
%----------------------------------------------------------------------------------------
% Control whether to build all heavy chapters (ideas, games, annotations).
% Default: build everything. A wrapper file can define \nobuildall before
% loading this file to disable them.
\newif\ifbuildall
\buildalltrue
\ifdefined\nobuildall
  \buildallfalse
\fi

% PDF metadata and link appearance
\hypersetup{
	pdftitle={My Chess Notebook}, % Title field
	pdfauthor={Ming Lu}, % Author field
	pdfsubject={Chess}, % Subject field
	pdfkeywords={chess, ideas, games, annotations}, % Keywords
	pdfcreator={LaTeX}, % Content creator field
	% Make links colored instead of framed rectangles
	colorlinks=true,
	linkcolor=ocre,
	citecolor=ocre,
	urlcolor=ocre
}

\addbibresource{../sample.bib} % Bibliography file

\definecolor{ocre}{RGB}{243, 102, 25} % Define the color used for highlighting throughout the book

% These commands came from the old Legrand class; provide no-op versions so
% existing content still compiles under memoir. You can later redefine them
% if you want fancy chapter images again.
\newcommand{\chapterimage}[1]{} % Chapter heading image (ignored for now)
\newcommand{\chapterspaceabove}[1]{} % Whitespace above chapter title box
\newcommand{\chapterspacebelow}[1]{} % Whitespace below chapter title box

\chapterimage{../Images/zen-stone.jpg}
\chapterspaceabove{6.5cm}
\chapterspacebelow{6.75cm}

\usepackage{chessboard}
\usepackage{xskak}
\usepackage{sectsty}
\usepackage{tocloft}
\usepackage{epigraph}
\usepackage{multicol}
\usepackage{tikz}

% Define \titlepage command to match Legrand template style
% Usage: \titlepage{background image code}{title text}{author text}
\newcommand{\titlepage}[3]{%
	\thispagestyle{empty}%
	\newgeometry{left=0cm,right=0cm,top=0cm,bottom=0cm}%
	\begin{tikzpicture}[remember picture,overlay]%
		\node[anchor=center,inner sep=0] at (current page.center) {#1};%
		\node[anchor=center,align=center] at ([yshift=3cm]current page.center) {\rmfamily\fontsize{50}{60}\selectfont\bfseries #2};%
		\node[anchor=center,align=center] at ([yshift=-2cm]current page.center) {\rmfamily\fontsize{36}{44}\selectfont\bfseries #3};%
	\end{tikzpicture}%
	\restoregeometry%
	\clearpage%
}

%----------------------------------------------------------------------------------------

\begin{document}

%----------------------------------------------------------------------------------------
%	TITLE PAGE (memoir style)
%----------------------------------------------------------------------------------------

\titlepage % Output the title page
	{\includegraphics[width=\paperwidth,height=\paperheight,keepaspectratio=false]{../Images/Delicate chessboard with a soft accent.png}} % Code to output the background image, which should be the same dimensions as the paper to fill the page entirely; leave empty for no background image
	{My Chess Notebook} % Book title
	{Ming Lu} % Author name

%----------------------------------------------------------------------------------------
%	COPYRIGHT PAGE
%----------------------------------------------------------------------------------------

\thispagestyle{empty} % Suppress headers and footers on this page

~\vfill % Push the text down to the bottom of the page

\noindent Copyright \copyright\ 2025 Ming Lu\\ % Copyright notice

%----------------------------------------------------------------------------------------
%	TABLE OF CONTENTS
%----------------------------------------------------------------------------------------
\newpage
\pagestyle{empty} % Disable headers and footers for the following pages
\newcommand{\Color}[1]{\hypersetup{linkcolor=#1}\color{#1}}

\titlespacing*{\part}{10em}{0em}{0em}
% Optionally change font style
\renewcommand{\cftpartfont}{\Large\bfseries\Color{ocre}} 
\renewcommand{\cftchapfont}{\Large\bfseries\Color{ocre}} 
\renewcommand{\cftsecfont}{\large}  % Bold section font
\renewcommand{\cftsubsecfont}{\large\itshape} % Italic subsection font
\renewcommand{\cftsecpagefont}{\large}   % Page numbers for sections
\renewcommand{\cftsubsecpagefont}{\large} % Page numbers for subsections

\begingroup % start a TeX group
\color{ocre}% or whatever color you wish to use
\tableofcontents* % Output the table of contents (no self-entry)
\endgroup


\pagestyle{fancy} % Enable default headers and footers again

\cleardoublepage % Start the following content on a new page

%----------------------------------------------------------------------------------------
%	HEADING COLORS (chapters/sections/subsections in text)
%----------------------------------------------------------------------------------------

% Chapter heading: ocre, same font size as default
\titleformat{\chapter}
  {\normalfont\huge\bfseries\color{ocre}} % format
  {\thechapter}                            % label
  {1em}                                    % sep
  {#1}                                     % before-code (title text)

% Unnumbered chapters (\chapter*)
\titleformat{name=\chapter,numberless}
  {\normalfont\huge\bfseries\color{ocre}}
  {}
  {0pt}
  {#1}

% Section heading
\titleformat{\section}
  {\normalfont\Large\bfseries\color{ocre}}
  {\thesection}
  {1em}
  {#1}

% Unnumbered sections (\section*)
\titleformat{name=\section,numberless}
  {\normalfont\Large\bfseries\color{ocre}}
  {}
  {0pt}
  {#1}

% Subsection heading
\titleformat{\subsection}
  {\normalfont\large\bfseries\color{ocre}}
  {\thesubsection}
  {1em}
  {#1}

% Unnumbered subsections (\subsection*)
\titleformat{name=\subsection,numberless}
  {\normalfont\large\bfseries\color{ocre}}
  {}
  {0pt}
  {#1}

% Define a macro for keywords, the keywords are displayed in italic
\newcommand{\keywords}[1]{Keywords: \textit{#1}}

% Vocabulary/glossary helper:
%   #1 = key (no spaces, e.g. hanging-pawns)
%   #2 = word as printed in the text (e.g. hanging pawns)
%   #3 = meaning (definition)
\newcommand{\vocab}[3]{%
  \ifglsentryexists{#1}{%
    \gls{#1}% use existing entry
  }{%
    \newglossaryentry{#1}{name={#2},description={#3}}%
    \gls{#1}% first use also prints as a glossary link
  }%
}

% Include chess tools
\input{../cards/chess/chess-tool}

%----------------------------------------------------------------------------------------
%	Main Content
%----------------------------------------------------------------------------------------
\chapter*{Preface}
\addcontentsline{toc}{chapter}{Preface}
\input{preface}
\chapter*{Introduction}
\addcontentsline{toc}{chapter}{Introduction}
\input{../cards/chess/explanation-of-symbols}
\section*{Visualization the Three Questions}
\input{../cards/chess/visualization-board}
\section*{Process of Elimination}
\input{../cards/chess/process_of_elimination}

%----------------------------------------------------------------------------------------
%	GLOSSARY
%----------------------------------------------------------------------------------------
\cleardoublepage
\phantomsection
\addcontentsline{toc}{chapter}{\textcolor{ocre}{Glossary}}
\printglossary[title={Glossary}]

\chapter{Chess Ideas and Patterns}

\ifbuildall
	\input{../cards/chess/ideas/ideas}
	\input{../cards/chess/maneuvering/maneuvering}
	\input{../cards/chess/my_games/my-games}
	\input{../cards/chess/annotations/annotation}
\else
	% Lite build: skip ideas, games and annotations to speed up compilation.
	\input{../cards/chess/ideas/catalan/setup-center}
\fi

%----------------------------------------------------------------------------------------
%	BIBLIOGRAPHY
%----------------------------------------------------------------------------------------

\chapterimage{} % Chapter heading image
\chapterspaceabove{2.5cm} % Whitespace from the top of the page to the chapter title on chapter pages
\chapterspacebelow{2cm} % Amount of vertical whitespace from the top margin to the start of the text on chapter pages

%------------------------------------------------

\chapter*{Bibliography}
\markboth{\sffamily\normalsize\bfseries Bibliography}{\sffamily\normalsize\bfseries Bibliography} % Set the page headers to display a Bibliography chapter name
\addcontentsline{toc}{chapter}{\textcolor{ocre}{Bibliography}} % Add a Bibliography heading to the table of contents

%\section*{Articles}
%\addcontentsline{toc}{section}{Articles} % Add the Articles subheading to the table of contents

\printbibliography[heading=bibempty, type=article] % Output article bibliography entries

\section*{Books}
\addcontentsline{toc}{section}{Books} % Add the Books subheading to the table of contents

\printbibliography[heading=bibempty, type=book] % Output book bibliography entries

%----------------------------------------------------------------------------------------
%	INDEX
%----------------------------------------------------------------------------------------

% Workaround: index entries are off by 2 pages in the .idx file.
% Adjust the page number and link target used by \hyperpage (only used in the index).
\makeatletter
\renewcommand*{\hyperpage}[1]{%
  \begingroup
  \edef\Hy@page{\number\numexpr#1+1\relax}%
  \hyper@linkstart{link}{page.\Hy@page}%
  \Hy@page
  \hyper@linkend
  \endgroup
}
\makeatother

\cleardoublepage % Make sure the index starts on an odd (right side) page
\phantomsection
\printindex % Output the index

%----------------------------------------------------------------------------------------

\end{document}
